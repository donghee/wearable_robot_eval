%% ffunction

function F=ff_func(X)

global a_u b_u a_f b_f m_d_u m_d_f q_u_0 q_f_0 K_u K_f K_u_nor K_f_nor L_h_u L_h_f m_h_u m_h_f g
global L_d_u L_d_f K_t_u K_t_f l_s_u_0 l_s_f_0 d_d a G_h_u G_h_f G_d_u G_d_f

q_u=X(1); q_f=X(2);

f1 = (conj(K_t_u)*(2*conj(q_u) - 2*conj(q_u_0)))/2 - conj(K_f)*((cos(conj(q_u))*conj(L_d_u) + cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_f) - conj(L_d_f)*cos(conj(d_d) - conj(q_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u)) - (cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(q_u))*conj(L_d_u) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_f) + conj(L_d_f)*sin(conj(d_d) - conj(q_u))))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2)*(conj(l_s_f_0) - (sin(conj(q_u))*conj(L_d_u) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_f) + conj(L_d_f)*sin(conj(d_d) - conj(q_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u))) + conj(K_u)*((cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(q_f))*conj(L_d_f) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_u) + conj(L_d_u)*sin(conj(d_d) - conj(q_f))))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2 - (cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_u))/sin(conj(q_f) - conj(d_d) + conj(q_u)))*(conj(l_s_u_0) - (sin(conj(q_f))*conj(L_d_f) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_u) + conj(L_d_u)*sin(conj(d_d) - conj(q_f)))/sin(conj(q_f) - conj(d_d) + conj(q_u))) + conj(g)*conj(m_h_f)*((cos(conj(a) + conj(q_u))*conj(L_d_u)*sin(conj(d_d) - conj(q_f)) + sin(conj(q_f))*cos(conj(a) + conj(q_u))*conj(L_d_f) + sin(conj(a))*cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u))/sin(conj(q_f) - conj(d_d) + conj(q_u)) - (cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(a) + conj(q_u))*conj(L_d_u)*sin(conj(d_d) - conj(q_f)) + sin(conj(q_f))*sin(conj(a) + conj(q_u))*conj(L_d_f) + sin(conj(a))*sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2) + conj(g)*conj(m_h_u)*((cos(conj(a) + conj(q_u))*conj(L_d_u)*sin(conj(d_d) - conj(q_f)) + sin(conj(q_f))*cos(conj(a) + conj(q_u))*conj(L_d_f) + sin(conj(a))*cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u))/sin(conj(q_f) - conj(d_d) + conj(q_u)) + cos(conj(a) + conj(q_u))*conj(G_h_u)*conj(L_h_u) - (cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(a) + conj(q_u))*conj(L_d_u)*sin(conj(d_d) - conj(q_f)) + sin(conj(q_f))*sin(conj(a) + conj(q_u))*conj(L_d_f) + sin(conj(a))*sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2);
 
f2 = (conj(K_t_f)*(2*conj(q_f) - 2*conj(q_f_0)))/2 - conj(K_u)*((cos(conj(q_f))*conj(L_d_f) + cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_u) - conj(L_d_u)*cos(conj(d_d) - conj(q_f)))/sin(conj(q_f) - conj(d_d) + conj(q_u)) - (cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(q_f))*conj(L_d_f) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_u) + conj(L_d_u)*sin(conj(d_d) - conj(q_f))))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2)*(conj(l_s_u_0) - (sin(conj(q_f))*conj(L_d_f) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_u) + conj(L_d_u)*sin(conj(d_d) - conj(q_f)))/sin(conj(q_f) - conj(d_d) + conj(q_u))) + conj(K_f)*((cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(q_u))*conj(L_d_u) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_f) + conj(L_d_f)*sin(conj(d_d) - conj(q_u))))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2 - (cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_f))/sin(conj(q_f) - conj(d_d) + conj(q_u)))*(conj(l_s_f_0) - (sin(conj(q_u))*conj(L_d_u) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_f) + conj(L_d_f)*sin(conj(d_d) - conj(q_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u))) + conj(g)*conj(m_h_u)*((cos(conj(q_f))*sin(conj(a) + conj(q_u))*conj(L_d_f) - sin(conj(a) + conj(q_u))*conj(L_d_u)*cos(conj(d_d) - conj(q_f)) + sin(conj(a))*cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u))/sin(conj(q_f) - conj(d_d) + conj(q_u)) - (cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(a) + conj(q_u))*conj(L_d_u)*sin(conj(d_d) - conj(q_f)) + sin(conj(q_f))*sin(conj(a) + conj(q_u))*conj(L_d_f) + sin(conj(a))*sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2) - conj(g)*conj(m_h_f)*(cos(conj(a) + conj(d_d) - conj(q_f))*conj(G_h_f)*conj(L_h_f) - (cos(conj(q_f))*sin(conj(a) + conj(q_u))*conj(L_d_f) - sin(conj(a) + conj(q_u))*conj(L_d_u)*cos(conj(d_d) - conj(q_f)) + sin(conj(a))*cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u))/sin(conj(q_f) - conj(d_d) + conj(q_u)) + (cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(a) + conj(q_u))*conj(L_d_u)*sin(conj(d_d) - conj(q_f)) + sin(conj(q_f))*sin(conj(a) + conj(q_u))*conj(L_d_f) + sin(conj(a))*sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2);

F = [f1 f2]';